<div class="container">

  <form [formGroup]="bunsForm" (ngSubmit)="startBakery()" class="control-form">
    <h2 class="control-form__title">Добро пожаловать, {{ currentUserUsername || 'Гость' }}</h2>

    <div class="input-wrapper">
      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Количество булочек</mat-label>
        <input
          matInput
          formControlName="bunsCount"
          id="bunsCount"
          type="number">

        <mat-error *ngIf="bunsCount?.hasError('required') && bunsCount?.touched">
          Поле обязательно для заполнения
        </mat-error>
        <mat-error *ngIf="bunsCount?.hasError('notPositive') && bunsCount?.touched && !bunsCount?.hasError('required')">
          Значение должно быть положительным
        </mat-error>

      </mat-form-field>
    </div>

    <button mat-flat-button color="primary" class="control-form__button">Запустить пекарню</button>
  </form>

  <div class="table-container">
    <h3 class="table-container__title">Список булочек</h3>
    <div class="table-scroll">
      <table mat-table [dataSource]="buns ?? []" class="mat-elevation-z8 table">
        <ng-container matColumnDef="type">
          <th mat-header-cell *matHeaderCellDef class="table__header">Тип</th>
          <td mat-cell *matCellDef="let bun" class="table__cell">{{ bun.type | bunName }}</td>
        </ng-container>

        <ng-container matColumnDef="initialCost">
          <th mat-header-cell *matHeaderCellDef class="table__header">Начальная стоимость</th>
          <td mat-cell *matCellDef="let bun" class="table__cell">{{ bun.initialCost | currency:'₽':'symbol':'1.2-2' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="currentCost">
          <th mat-header-cell *matHeaderCellDef class="table__header">Текущая стоимость</th>
          <td mat-cell *matCellDef="let bun" class="table__cell">{{ bun.currentCost | currency:'₽':'symbol':'1.2-2' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="predictedPrice">
          <th mat-header-cell *matHeaderCellDef class="table__header">Прогнозируемая цена</th>
          <td mat-cell *matCellDef="let bun" class="table__cell">
            {{ bun.predictedCost !== null ? (bun.predictedCost.cost | currency:'₽':'symbol':'1.2-2') : 'Цена окончательна' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="predictedTime">
          <th mat-header-cell *matHeaderCellDef class="table__header">Время до изменения цены</th>
          <td mat-cell *matCellDef="let bun" class="table__cell">
            {{ bun.predictedCost !== null ? (bun.predictedCost.date | timeFormatPipe) : '-' }}
          </td>
        </ng-container>

        <tr mat-header-row
            *matHeaderRowDef="['type', 'initialCost', 'currentCost', 'predictedPrice', 'predictedTime']"></tr>
        <tr mat-row
            *matRowDef="let row; columns: ['type', 'initialCost', 'currentCost', 'predictedPrice', 'predictedTime'];"></tr>
      </table>

    </div>

    <mat-paginator [length]="totalCount"
                   [pageIndex]="page -1"
                   [pageSize]="limit"
                   [pageSizeOptions]="[5,10,15,20]"
                   (page)="onPaginateChange($event)"
                   showFirstLastButtons="true">
    </mat-paginator>

    <div class="logout-button">
      <button mat-flat-button color="primary" class="logout-button__button" (click)="logout()">
        Выйти
      </button>
    </div>
  </div>
</div>
